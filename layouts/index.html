{{- define "main" }}

{{- if (ne .Site.Params.profileMode.enabled true) }}
{{- partial "index_profile.html" . }}
{{- end }}

{{- if .Site.Params.profileMode.enabled }}
{{/* 自訂的 Profile + Posts 混合模式 */}}
<article class="first-entry profile">
  <div class="profile_inner">
    {{- if .Site.Params.profileMode.imageUrl -}}
    {{- $size := "120x120" }}
    {{- if (and .Site.Params.profileMode.imageWidth .Site.Params.profileMode.imageHeight) }}
    {{- $size = printf "%dx%d" .Site.Params.profileMode.imageWidth .Site.Params.profileMode.imageHeight }}
    {{- end }}
    <img draggable="false" src="{{ .Site.Params.profileMode.imageUrl | absURL }}" alt="{{ .Site.Params.profileMode.imageTitle | default .Site.Title }}" title="{{ .Site.Params.profileMode.imageTitle | default .Site.Title }}" height="{{ .Site.Params.profileMode.imageHeight | default 120 }}" width="{{ .Site.Params.profileMode.imageWidth | default 120 }}" />
    {{- end }}
    <h1>
      {{ .Site.Params.profileMode.title | default .Site.Title }}
    </h1>
    <span class="subtitle">
      {{ .Site.Params.profileMode.subtitle }}</span>
    {{- if .Site.Params.profileMode.buttons }}
    <div class="buttons">
      {{- range .Site.Params.profileMode.buttons }}
      <a class="button" href="{{ .url | absURL }}" rel="noopener" title="{{ .name }}">
        <span class="button-inner">
          {{ .name }}
        </span>
      </a>
      {{- end }}
    </div>
    {{- end }}
    {{- if .Site.Params.socialIcons }}
    <div class="social-icons">
      {{- range .Site.Params.socialIcons }}
      <a href="{{ .url }}" target="_blank" rel="noopener noreferrer me" title="{{ .title }}">
        {{- partial "svg.html" (dict "ctx" $ "name" .name) }}
      </a>
      {{- end }}
    </div>
    {{- end }}
  </div>
</article>
{{- end }}

{{/* 文章列表區域 */}}
<div class="featured-posts">
  <header class="page-header">
    <h2>🔥 最新文章</h2>
    <p>探索資安研究與 CTF 解題心得</p>
  </header>
  {{- $pages := where site.RegularPages "Type" "in" site.Params.mainSections }}
  {{- $pages = $pages | first 6 }}
  {{- range $pages }}
  <article class="post-entry">
    {{ $isHidden := (.Params.cover.hidden | default .Site.Params.cover.hiddenInList | default .Site.Params.cover.hidden) }}
    {{- partial "cover.html" (dict "cxt" . "IsHome" true "isHidden" $isHidden) }}
    <header class="entry-header">
      <h2 class="entry-hint-parent">
        {{ .Title }}
        {{- with .Description }}
        <span class="entry-hint" title="{{ . }}">
          {{ . }}</span>
        {{- end }}
      </h2>
    </header>
    {{- if (ne (.Param "hideSummary") true) }}
    <div class="entry-content">
      <p>
        {{ .Summary | plainify | htmlUnescape }}
        {{ if .Truncated }}...
        {{ end }}
      </p>
    </div>
    {{- end }}
    {{- if not (.Param "hideMeta") }}
    <footer class="entry-footer">
      {{- partial "post_meta.html" . -}}
    </footer>
    {{- end }}
    <a class="entry-link" aria-label="post link to {{ .Title | plainify }}" href="{{ .Permalink }}"></a>
  </article>
  {{- end }}

  <div class="view-all-posts">
    <a href="/posts/" class="view-all-button">
      查看所有文章 →
    </a>
  </div>
</div>

{{- end }}{{/* end main */}}