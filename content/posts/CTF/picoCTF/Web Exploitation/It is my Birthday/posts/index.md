---
title: "picoCTF It is my Birthday [100 points]"
date:  2023-12-24
categories: [CTF]
tags:       [Web Exploit]
---
# Description

> I sent out 2 invitations to all of my friends for my birthday! I’ll know if they get stolen because the two invites look similar, and they even have the same md5 hash, but they are slightly different! You wouldn’t believe how long it took me to find a collision. Anyway, see if you’re invited by submitting 2 PDFs to my website. http://mercury.picoctf.net:50970/

# Hint

> Look at the category of this problem.  
> How may a PHP site check the rules in the description?

# Solution

一進來網頁後看到可以上傳檔案，根據題目的提示似乎要檢查上傳pdf檔且md5值要一致  


> 思路：自己產出一個兩個不同的字串但有相同的 PREFIX 和相同的 md5 值的檔案且副檔名要為pdf

首先先安裝fastcoll這個工具

``` line-numbers
sudo apt install libboost-filesystem-dev libboost-program-options-dev 
git clone https://github.com/brimstone/fastcoll.git
cd fastclone
g++ -O3 *.cpp -lboost_filesystem -lboost_program_options -lboost_system -o fastcoll -static && strip fastcoll
```

執行完後會在當前目錄產生fastoll執行檔，之後創建任意一個檔案當作prefix標準

``` line-numbers
touch ntust
```

使用指令產出兩個pdf檔案(兩個不同的字串但有相同的 PREFIX 和相同的 md5 值的檔案)

``` line-numbers
./fastcoll -p ntust -o ../1.pdf ../2.pdf
```

把檔案丟上去並送出，拿到此php source code

``` line-numbers
<?php

if (isset($_POST["submit"])) {
    $type1 = $_FILES["file1"]["type"];
    $type2 = $_FILES["file2"]["type"];
    $size1 = $_FILES["file1"]["size"];
    $size2 = $_FILES["file2"]["size"];
    $SIZE_LIMIT = 18 * 1024;

    if (($size1 < $SIZE_LIMIT) && ($size2 < $SIZE_LIMIT)) {
        if (($type1 == "application/pdf") && ($type2 == "application/pdf")) {
            $contents1 = file_get_contents($_FILES["file1"]["tmp_name"]);
            $contents2 = file_get_contents($_FILES["file2"]["tmp_name"]);

            if ($contents1 != $contents2) {
                if (md5_file($_FILES["file1"]["tmp_name"]) == md5_file($_FILES["file2"]["tmp_name"])) {
                    highlight_file("index.php");
                    die();
                } else {
                    echo "MD5 hashes do not match!";
                    die();
                }
            } else {
                echo "Files are not different!";
                die();
            }
        } else {
            echo "Not a PDF!";
            die();
        }
    } else {
        echo "File too large!";
        die();
    }
}

// FLAG: picoCTF{c0ngr4ts_u_r_1nv1t3d_73b0c8ad}

?>




    It is my Birthday


    

    

    

    






    
        
            It is my Birthday
        
        
            
            
                
                    See if you are invited to my party!
                
            
            
            
                
                
                    
                        
                        
                    
                
                
                    
                        
                    
                
                
            
        
    
    
        &copy; PicoCTF
    




$(document).ready(function(){
    $(".close").click(function(){
        $("myAlert").alert("close");
    });
});




```

> flag: picoCTF{c0ngr4ts_u_r_1nv1t3d_73b0c8ad}
